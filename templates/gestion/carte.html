{% extends 'gestion/base.html' %}
{% load static %}

{% block page_title %}Cartes et Itin√©raires{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.fullscreen@1.6.0/Control.FullScreen.css" />
<style>
#map-container {
    height: 600px;
    width: 100%;
    border-radius: 10px;
    border: 2px solid #dee2e6;
    margin-top: 20px;
}

#carte-iframe {
    width: 100%;
    height: 500px;
    border: none;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.card-stat {
    transition: transform 0.3s ease;
}

.card-stat:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.2);
}

.optimisation-form {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    padding: 20px;
    border-radius: 10px;
    border: 1px solid #dee2e6;
    margin-bottom: 20px;
}

#loading-optimisation {
    background: rgba(255, 255, 255, 0.9);
    border-radius: 10px;
    padding: 40px;
    text-align: center;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1000;
}

.alert-fixed {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 9999;
    max-width: 400px;
}

.map-container-wrapper {
    position: relative;
    min-height: 600px;
}

/* AJOUTEZ CES NOUVEAUX STYLES ICI : */

/* Styles pour les marqueurs personnalis√©s */
.custom-marker {
    background: none !important;
    border: none !important;
}

.warning-marker {
    background: none !important;
    border: none !important;
}

/* Styles pour les popups */
.leaflet-popup-content {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    max-width: 300px;
}

.leaflet-popup-content-wrapper {
    border-radius: 8px;
    box-shadow: 0 3px 14px rgba(0,0,0,0.4);
}

/* Styles pour les tooltips */
.leaflet-tooltip {
    font-size: 12px;
    font-weight: bold;
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid #3498db;
    border-radius: 4px;
    padding: 4px 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}

.leaflet-tooltip-top:before {
    border-top-color: #3498db;
}

.leaflet-tooltip-bottom:before {
    border-bottom-color: #3498db;
}

/* Am√©lioration de l'apparence g√©n√©rale */
.leaflet-container {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

/* Styles pour les contr√¥les de la carte */
.leaflet-control-zoom a {
    background: white;
    color: #333;
    border-radius: 4px;
    margin-bottom: 5px;
}

.leaflet-control-zoom a:hover {
    background: #f8f9fa;
}

/* Style pour le contr√¥le plein √©cran */
.leaflet-control-fullscreen a {
    background: white;
    color: #333;
    border-radius: 4px;
}

/* Style pour la l√©gende de la carte */
.leaflet-control-attribution {
    font-size: 11px;
    background: rgba(255, 255, 255, 0.8);
    padding: 2px 5px;
    border-radius: 3px;
}

/* Animation pour les marqueurs */
@keyframes marker-pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

.custom-marker div {
    transition: all 0.3s ease;
}

.custom-marker div:hover {
    animation: marker-pulse 0.5s ease;
    transform: scale(1.1);
    box-shadow: 0 3px 10px rgba(0,0,0,0.4);
}

/* Styles pour les diff√©rents types de marqueurs */
.marker-green {
    background-color: #28a745 !important;
}

.marker-blue {
    background-color: #007bff !important;
}

.marker-red {
    background-color: #dc3545 !important;
}

.marker-orange {
    background-color: #fd7e14 !important;
}

/* Responsive */
@media (max-width: 768px) {
    #map-container {
        height: 400px;
    }
    
    .leaflet-popup-content {
        max-width: 250px;
        font-size: 13px;
    }
    
    .leaflet-tooltip {
        font-size: 11px;
        padding: 3px 6px;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.fullscreen@1.6.0/Control.FullScreen.js"></script>
<script>
// Variables globales
let map = null;
let markers = [];

// Fonction pour r√©cup√©rer le token CSRF
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
function emergencyResize() {
    if (map) {
        setTimeout(() => {
            // Redimensionnement multiple
            map.invalidateSize(true);
            setTimeout(() => {
                map.invalidateSize(true);
                map.setView([35.8342, 10.6296], 13);
            }, 100);
        }, 200);
    }
}

// Appeler apr√®s chaque action
window.addEventListener('load', emergencyResize);
document.addEventListener('DOMContentLoaded', emergencyResize);
// Fonction pour afficher les alertes
function showAlert(message, type) {
    // Supprimer les alertes existantes
    const existingAlerts = document.querySelectorAll('.alert-fixed');
    existingAlerts.forEach(alert => alert.remove());
    
    // Cr√©er la nouvelle alerte
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type} alert-dismissible fade show alert-fixed`;
    alertDiv.innerHTML = `
        ${message}
        <button type="button" class="btn-close" onclick="this.parentElement.remove()"></button>
    `;
    
    document.body.appendChild(alertDiv);
    
    // Auto-suppression apr√®s 5 secondes
    setTimeout(() => {
        if (alertDiv.parentNode) {
            alertDiv.parentNode.removeChild(alertDiv);
        }
    }, 5000);
}

// Initialiser la carte
function initMap() {
    if (!map) {
        map = L.map('map-container').setView([35.8256, 10.6415], 12);
        
        // Ajouter la couche OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors',
            maxZoom: 19
        }).addTo(map);
        
        // Contr√¥le plein √©cran
        map.addControl(new L.Control.FullScreen());
        
        console.log('Carte initialis√©e');
    }
}

// Fonction pour charger les heures dynamiquement
function chargerHeuresOptimisation() {
    const typeTransport = document.getElementById('type-transport-optimisation');
    const heureSelect = document.getElementById('heure-optimisation');
    
    if (typeTransport && heureSelect) {
        typeTransport.addEventListener('change', function() {
            const type = this.value;
            
            if (!type) {
                heureSelect.innerHTML = '<option value="">S√©lectionner d\'abord le type</option>';
                return;
            }
            
            // Afficher chargement
            heureSelect.innerHTML = '<option value="">Chargement des heures...</option>';
            heureSelect.disabled = true;
            
            // Appeler l'API pour r√©cup√©rer les heures configur√©es
            fetch(`/chauffeurs/api/heures_par_type/?type_transport=${encodeURIComponent(type)}`)
                .then(response => {
                    if (!response.ok) throw new Error('Erreur r√©seau');
                    return response.json();
                })
                .then(data => {
                    heureSelect.innerHTML = '<option value="">S√©lectionner une heure</option>';
                    heureSelect.disabled = false;
                    
                    if (data && data.length > 0) {
                        data.forEach(heure => {
                            const option = document.createElement('option');
                            option.value = heure.value;
                            option.textContent = heure.text;
                            heureSelect.appendChild(option);
                        });
                    } else {
                        heureSelect.innerHTML = '<option value="">Aucune heure disponible</option>';
                    }
                })
                .catch(error => {
                    console.error('Erreur chargement heures:', error);
                    heureSelect.innerHTML = '<option value="">Erreur de chargement</option>';
                    heureSelect.disabled = false;
                });
        });
    }
}
// Appeler au chargement
document.addEventListener('DOMContentLoaded', function() {
    // ... votre code existant ...
    
    // AJOUTER CETTE LIGNE :
    chargerHeuresOptimisation();
});


// Fonction d'optimisation d'itin√©raire
function optimiserItineraire() {
    const jour = document.getElementById('jour-optimisation').value;
    const typeTransport = document.getElementById('type-transport-optimisation').value;
    const heure = document.getElementById('heure-optimisation').value;
    
    console.log(`Param√®tres: jour=${jour}, type=${typeTransport}, heure=${heure}`);
    
    // Validation
    if (!jour || !typeTransport || !heure) {
        showAlert('Veuillez remplir tous les champs', 'warning');
        return;
    }
    
    // Afficher loading
    const loadingDiv = document.getElementById('loading-optimisation');
    const resultDiv = document.getElementById('resultat-optimisation');
    if (loadingDiv) loadingDiv.style.display = 'block';
    if (resultDiv) resultDiv.style.display = 'none';
    
    // Nettoyer les anciens marqueurs
    clearMarkers();
    
    // Appeler l'API d'optimisation
    fetch('/geolocalisation/optimiser/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify({
            jour: jour,
            type_transport: typeTransport,
            heure: heure
        })
    })
    .then(response => {
        console.log(`R√©ponse optimisation: ${response.status}`);
        if (!response.ok) throw new Error(`Erreur HTTP: ${response.status}`);
        return response.json();
    })
    .then(data => {
        console.log('Donn√©es optimisation:', data);
        
        // Cacher le loading
        if (loadingDiv) loadingDiv.style.display = 'none';
        
        if (data.success) {
            afficherResultatOptimisation(data.rapport);
            afficherPointsSurCarte(data.rapport);
        } else {
            showAlert('Erreur: ' + (data.error || 'Erreur inconnue'), 'danger');
        }
    })
    .catch(error => {
        console.error('Erreur optimisation:', error);
        if (loadingDiv) loadingDiv.style.display = 'none';
        showAlert('Erreur r√©seau: ' + error.message, 'danger');
    });
}

// Afficher les r√©sultats de l'optimisation
function afficherResultatOptimisation(rapport) {
    const resultDiv = document.getElementById('resultat-optimisation');
    const detailsDiv = document.getElementById('details-itineraire');
    
    if (!resultDiv || !detailsDiv) return;
    
    // Extraire les donn√©es
    const distance = rapport.statistiques?.distance_totale_km || 0;
    const agents = rapport.meta?.nombre_agents || 0;
    const temps = rapport.statistiques?.temps_estime_minutes || 0;
    const economie = rapport.statistiques?.economie_estimee_km || 0;
    const optimise = rapport.optimise || false;
    
    // Construire le HTML des d√©tails
    let detailsHTML = `
        <div class="card">
            <div class="card-header ${optimise ? 'bg-success' : 'bg-info'} text-white">
                <h5 class="card-title mb-0">
                    <i class="fas fa-map-marker-alt"></i> ${optimise ? 'Itin√©raire Optimis√©' : 'Visualisation des Agents'}
                </h5>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-3 mb-2">
                        <div class="card bg-primary text-white text-center">
                            <div class="card-body py-2">
                                <h5 class="card-title mb-0">${agents}</h5>
                                <small>Agents trouv√©s</small>
                            </div>
                        </div>
                    </div>
    `;
    
    if (optimise && agents > 1) {
        detailsHTML += `
                    <div class="col-md-3 mb-2">
                        <div class="card bg-success text-white text-center">
                            <div class="card-body py-2">
                                <h5 class="card-title mb-0">${distance} km</h5>
                                <small>Distance totale</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-2">
                        <div class="card bg-warning text-white text-center">
                            <div class="card-body py-2">
                                <h5 class="card-title mb-0">${temps} min</h5>
                                <small>Temps estim√©</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-2">
                        <div class="card bg-danger text-white text-center">
                            <div class="card-body py-2">
                                <h5 class="card-title mb-0">${economie} km</h5>
                                <small>√âconomie estim√©e</small>
                            </div>
                        </div>
                    </div>
        `;
    }
    
    detailsHTML += `
                </div>
                
                <h6><i class="fas fa-users"></i> Liste des agents (${agents}):</h6>
                <div class="table-responsive">
                    <table class="table table-sm table-striped">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Agent</th>
                                <th>Adresse</th>
                                <th>Soci√©t√©</th>
                                <th>Heure</th>
                            </tr>
                        </thead>
                        <tbody>
    `;
    
    if (rapport.itineraire && Array.isArray(rapport.itineraire)) {
        rapport.itineraire.forEach((point, index) => {
            detailsHTML += `
                <tr>
                    <td><span class="badge ${optimise ? 'bg-primary' : 'bg-secondary'}">${index + 1}</span></td>
                    <td><strong>${point.nom || 'Non sp√©cifi√©'}</strong></td>
                    <td><small>${point.adresse || 'Non sp√©cifi√©'}</small></td>
                    <td><span class="badge bg-info">${point.societe || 'N/A'}</span></td>
                    <td><span class="badge bg-dark">${point.heure || 'N/A'}</span></td>
                </tr>
            `;
        });
    }
    
    detailsHTML += `
                        </tbody>
                    </table>
                </div>
                
                <div class="alert ${optimise && agents > 1 ? 'alert-success' : 'alert-info'} mt-3">
                    <i class="fas ${optimise && agents > 1 ? 'fa-route' : 'fa-map-marker-alt'}"></i>
                    ${optimise && agents > 1 
                        ? `<strong>Itin√©raire optimis√©</strong> pour ${agents} agents. Distance totale: ${distance} km.` 
                        : `<strong>Visualisation</strong> de ${agents} agent(s) sur la carte. ${agents === 1 ? 'Un seul agent trouv√© pour ce cr√©neau.' : ''}`}
                </div>
                
                <div class="text-center mt-3">
                    <button class="btn btn-primary me-2" onclick="window.print()">
                        <i class="fas fa-print"></i> Imprimer
                    </button>
                    <a href="/geolocalisation/rapport/" class="btn btn-info">
                        <i class="fas fa-file-alt"></i> Rapport complet
                    </a>
                </div>
            </div>
        </div>
    `;
    
    detailsDiv.innerHTML = detailsHTML;
    resultDiv.style.display = 'block';
    
    // Afficher notification adapt√©e
    if (optimise && agents > 1) {
        showAlert(`‚úÖ Itin√©raire optimis√© pour ${agents} agents!`, 'success');
    } else if (agents === 1) {
        showAlert(`üìç 1 agent trouv√© et affich√© sur la carte`, 'info');
    } else {
        showAlert(`üìç ${agents} agents affich√©s sur la carte`, 'info');
    }
}
// Afficher les points sur la carte
function afficherPointsSurCarte(rapport) {
    console.log('üìç DEBUG - Rapport re√ßu:', rapport);
    console.log('üìç DEBUG - Itin√©raire:', rapport.itineraire);
    console.log('üìç DEBUG - Type:', typeof rapport.itineraire);
    console.log('üìç DEBUG - Est array?', Array.isArray(rapport.itineraire));

    if (!map || !rapport.itineraire) return;
    
    // Nettoyer les anciens marqueurs
    clearMarkers();
    
    const points = rapport.itineraire;
    const coordinates = [];
    
    console.log(`üìç Affichage de ${points.length} point(s) sur la carte`);
    
    // Ajouter chaque point √† la carte
    points.forEach((point, index) => {
        if (point.latitude && point.longitude) {
            const lat = parseFloat(point.latitude);
            const lon = parseFloat(point.longitude);
            
            coordinates.push([lat, lon]);
            
            // D√©terminer la couleur du marqueur
            let color = 'blue';
            let tooltipText = `#${index + 1}: ${point.nom || 'Point'}`;
            
            if (points.length === 1) {
                // Un seul point : marqueur sp√©cial
                color = 'green';
                tooltipText = `üìç ${point.nom || 'Agent'}`;
            } else if (index === 0) {
                color = 'green';
                tooltipText = `üèÅ D√âPART: ${point.nom || 'Point 1'}`;
            } else if (index === points.length - 1) {
                color = 'red';
                tooltipText = `üéØ ARRIV√âE: ${point.nom || 'Point ' + points.length}`;
            } else {
                tooltipText = `#${index + 1}: ${point.nom || 'Point ' + (index + 1)}`;
            }
            
            // Cr√©er le marqueur
            const marker = L.marker([lat, lon], {
                icon: L.icon({
                    iconUrl: `https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x-${color}.png`,
                    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',
                    iconSize: [25, 41],
                    iconAnchor: [12, 41],
                    popupAnchor: [1, -34],
                    shadowSize: [41, 41]
                })
            }).addTo(map);
            
            // Ajouter popup avec plus d'informations
            const popupContent = `
                <div style="min-width: 200px;">
                    <strong>${point.nom || 'Agent'}</strong><br>
                    <hr style="margin: 5px 0;">
                    <small><strong>Adresse:</strong><br>${point.adresse || 'Non sp√©cifi√©e'}</small><br>
                    <small><strong>Soci√©t√©:</strong> ${point.societe || 'N/A'}</small><br>
                    <small><strong>T√©l√©phone:</strong> ${point.telephone || 'N/A'}</small>
                    ${point.heure ? `<br><small><strong>Heure:</strong> ${point.heure}</small>` : ''}
                </div>
            `;
            marker.bindPopup(popupContent);
            marker.bindTooltip(tooltipText);
            
            markers.push(marker);
        }
    });
    
    // Ajuster la vue de la carte pour inclure tous les points
    if (coordinates.length > 0) {
        if (coordinates.length === 1) {
            // Un seul point : zoomer dessus
            map.setView(coordinates[0], 14);
        } else {
            // Plusieurs points : ajuster la vue
            const bounds = L.latLngBounds(coordinates);
            map.fitBounds(bounds, { padding: [50, 50] });
        }
    }
    
    // Tracer la ligne de l'itin√©raire seulement si plus d'un point
    if (coordinates.length > 1) {
        const polyline = L.polyline(coordinates, {
            color: '#3498db',
            weight: 4,
            opacity: 0.7,
            dashArray: '5, 5'
        }).addTo(map);
        markers.push(polyline);
    }
}
// Nettoyer les marqueurs
function clearMarkers() {
    markers.forEach(marker => {
        if (marker.remove) marker.remove();
    });
    markers = [];
}

// Initialisation au chargement de la page
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM charg√© - initialisation...');
    
    // Initialiser la carte
    initMap();
    
    // Charger les heures
    chargerHeuresOptimisation();
    
    // Ajouter l'√©v√©nement au bouton d'optimisation
    const optimiserBtn = document.getElementById('btn-optimiser');
    if (optimiserBtn) {
        optimiserBtn.addEventListener('click', optimiserItineraire);
    }
    
    // Ajouter aussi l'√©v√©nement Enter sur les champs
    const inputs = document.querySelectorAll('#form-optimisation input, #form-optimisation select');
    inputs.forEach(input => {
        input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                optimiserItineraire();
            }
        });
    });
    
    console.log('Page carte initialis√©e');
});

</script>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-map-marked-alt"></i> Optimisation des Itin√©raires
                    </h5>
                    <div>
                        <a href="{% url 'statistiques_geolocalisation' %}" class="btn btn-info btn-sm">
                            <i class="fas fa-chart-bar"></i> Statistiques
                        </a>
                        <a href="{% url 'rapport_optimisation' %}" class="btn btn-warning btn-sm">
                            <i class="fas fa-file-alt"></i> Rapports
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Formulaire d'optimisation -->
                    <div class="row mb-4">
                        <div class="col-md-12">
                            <div class="optimisation-form">
                                <h6 class="mb-3"><i class="fas fa-cogs"></i> Param√®tres d'optimisation</h6>
                                <form id="form-optimisation" class="row g-3">
                                    <div class="col-md-3">
                                        <label class="form-label">Jour</label>
                                        <select id="jour-optimisation" class="form-control">
                                            <option value="">S√©lectionner un jour</option>
                                            <option value="Lundi">Lundi</option>
                                            <option value="Mardi">Mardi</option>
                                            <option value="Mercredi">Mercredi</option>
                                            <option value="Jeudi">Jeudi</option>
                                            <option value="Vendredi">Vendredi</option>
                                            <option value="Samedi">Samedi</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Type de transport</label>
                                        <select id="type-transport-optimisation" class="form-control">
                                            <option value="">S√©lectionner type</option>
                                            <option value="ramassage">Ramassage</option>
                                            <option value="depart">D√©part</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Heure</label>
                                        <select id="heure-optimisation" class="form-control">
                                            <option value="">Choisir le type d'abord</option>
                                            <!-- Les heures seront charg√©es dynamiquement -->
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">&nbsp;</label>
                                        <button type="button" id="btn-optimiser" class="btn btn-success w-100">
                                            <i class="fas fa-bolt"></i> Optimiser l'itin√©raire
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- Loading overlay -->
                    <div id="loading-optimisation" style="display: none;">
                        <div class="spinner-border spinner-border-lg text-primary" role="status">
                            <span class="visually-hidden">Chargement...</span>
                        </div>
                        <h5 class="mt-3">Optimisation en cours...</h5>
                        <p class="text-muted">Calcul du meilleur itin√©raire...</p>
                        <p><small>Cette op√©ration peut prendre quelques secondes</small></p>
                    </div>

                    <!-- R√©sultats -->
                    <div id="resultat-optimisation" style="display: none;">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="card mb-4">
                                    <div class="card-header bg-info text-white">
                                        <h6 class="card-title mb-0">
                                            <i class="fas fa-map"></i> Carte Interactive
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="map-container-wrapper">
                                            <div id="map-container"></div>
                                        </div>
                                        <div class="alert alert-info mt-3">
                                            <i class="fas fa-info-circle"></i>
                                            Cliquez sur les marqueurs pour voir les d√©tails. Utilisez les contr√¥les pour zoomer/d√©zoomer.
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div id="details-itineraire"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Carte par d√©faut (sans optimisation) -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header bg-secondary text-white">
                                    <h6 class="card-title mb-0">
                                        <i class="fas fa-globe"></i> Carte de Sousse
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div class="map-container-wrapper">
                                        <div id="map-container"></div>
                                    </div>
                                    <div class="alert alert-light mt-3">
                                        <i class="fas fa-lightbulb"></i>
                                        <strong>Instructions :</strong> S√©lectionnez jour, type et heure, puis cliquez sur "Optimiser l'itin√©raire" pour calculer le meilleur parcours.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Informations -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="card bg-light">
                                <div class="card-body">
                                    <h6><i class="fas fa-info-circle"></i> Comment utiliser l'optimisation :</h6>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <ol class="mb-0">
                                                <li>S√©lectionnez le jour de la semaine</li>
                                                <li>Choisissez "Ramassage" (matin) ou "Retour" (soir)</li>
                                                <li>L'heure se chargera automatiquement</li>
                                                <li>Cliquez sur "Optimiser l'itin√©raire"</li>
                                                <li>Visualisez le r√©sultat sur la carte</li>
                                            </ol>
                                        </div>
                                        <div class="col-md-6">
                                            <ul class="mb-0">
                                                <li><span class="badge bg-success">Vert</span> : Point de d√©part</li>
                                                <li><span class="badge bg-primary">Bleu</span> : Points interm√©diaires</li>
                                                <li><span class="badge bg-danger">Rouge</span> : Point d'arriv√©e</li>
                                                <li><span class="badge bg-info">Ligne bleue</span> : Itin√©raire optimal</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
